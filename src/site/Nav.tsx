'use client';

import { clsx } from 'clsx/lite';
import { usePathname } from 'next/navigation';
import Link from 'next/link';
import SiteGrid from '../components/SiteGrid';
import ViewSwitcher, { SwitcherSelection } from '@/site/ViewSwitcher';
import {
  PATH_ROOT,
  isPathAdmin,
  isPathGrid,
  isPathProtected,
  isPathSignIn,
} from '@/site/paths';
import AnimateItems from '../components/AnimateItems';
import { useAppState } from '@/state/AppState';

export default function Nav({
  siteDomainOrTitle,
}: {
  siteDomainOrTitle: string;
}) {
  const pathname = usePathname();

  const { isUserSignedIn } = useAppState();

  const showNav = !isPathSignIn(pathname);

  const renderLink = (
    text: string,
    linkOrAction: string | (() => void),
  ) =>
    typeof linkOrAction === 'string'
      ? <Link href={linkOrAction}>{text}</Link>
      : <button onClick={linkOrAction}>{text}</button>;

  const switcherSelectionForPath = (): SwitcherSelection | undefined => {
    if (pathname === PATH_ROOT) {
      return 'full-frame';
    } else if (isPathGrid(pathname)) {
      return 'grid';
    } else if (isPathProtected(pathname)) {
      return 'admin';
    }
  };

  return (
    <SiteGrid
      contentMain={
        <AnimateItems
          animateOnFirstLoadOnly
          type={!isPathAdmin(pathname) ? 'bottom' : 'none'}
          distanceOffset={10}
          items={showNav
            ? [<div
              key="nav"
              className={clsx(
                'flex items-center',
                'w-full min-h-[4rem]',
              )}>
              <div id="ezread-logo">
                <svg viewBox="0 0 268.32 53.76" xmlns="http://www.w3.org/2000/svg"><path d="m0 11h24.78v7.26h-16.33v4.66h14.79v6.73h-14.79v4.88h16.55v7.26h-25z" fill="#fff" /><path d="m28.38 35.6 15.45-17.38h-14.92v-7.22h26.71v6.21l-15.45 17.38h15.45v7.22h-27.24z" fill="#fff" /><g fill="#c9e7ef"><path d="m164.3 41.8-6.6-9.86h-5.32v9.86h-6.78v-30.8h14.08c7.26 0 11.62 3.83 11.62 10.17v.09c0 4.97-2.68 8.1-6.6 9.55l7.52 11h-7.92zm.13-20.28c0-2.9-2.02-4.4-5.32-4.4h-6.73v8.85h6.86c3.3 0 5.19-1.76 5.19-4.36z" /><path d="m176.84 41.8v-30.8h23.24v6.03h-16.5v6.25h14.52v6.03h-14.52v6.47h16.72v6.03h-23.46z" /><path d="m228.67 41.8-2.82-6.91h-13.03l-2.82 6.91h-6.91l13.2-31.02h6.25l13.2 31.02h-7.08zm-9.33-22.88-4.09 9.99h8.19l-4.09-9.99z" /><path d="m251.95 41.8h-12.01v-30.8h12.01c9.68 0 16.37 6.65 16.37 15.31v.09c0 8.67-6.69 15.4-16.37 15.4zm9.28-15.4c0-5.46-3.74-9.29-9.29-9.29h-5.24v18.57h5.24c5.54 0 9.29-3.74 9.29-9.2v-.09z" /></g><path d="m98.37 45.28c.02-.28.04-.42.04-.56 0-12.69 0-25.38-.02-38.07 0-.27-.2-.66-.43-.8-1.44-.89-2.88-1.79-4.38-2.55-4.6-2.3-9.44-3.57-14.62-3.25-3.41.21-6.77.73-10.09 1.56-.63.16-.9.35-.89 1.08.03 12.5.02 24.99.02 37.49v.63c3.18-.48 6.26-1.03 9.37-1.41 4.62-.55 9.11.08 13.43 1.84 2.63 1.06 5.12 2.38 7.57 4.04zm32.64-4.06v-39.38c-2.22-.43-4.43-.93-6.66-1.29-2.83-.45-5.69-.59-8.54-.17-5.08.75-9.67 2.78-13.98 5.51-.42.27-.57.56-.57 1.05.01 12.57.01 25.13.01 37.7 0 .23.02.45.04.85 9.22-6.49 19.1-7.64 29.68-4.29zm-30.89 8.68c-.86-.57-1.67-1.14-2.51-1.65-4.43-2.71-9.17-4.59-14.38-4.98-4.68-.35-9.33.18-13.93 1.05-1.35.26-2.69.54-4.14.83v-39.88c-.81.12-1.52.23-2.27.35v42.81c.09 0 .16.02.22.01.17-.03.33-.07.5-.11 4.75-1.04 9.54-1.78 14.42-1.99 7.46-.34 14.2 1.65 20.26 5.97.64.46 1.25.96 1.87 1.45.13-.1.22-.18.31-.26 4.98-4.08 10.68-6.51 17.09-7.07 4.87-.42 9.71.15 14.51 1.05 1.58.3 3.16.65 4.77.99v-42.68c-.96-.13-1.9-.26-2.94-.41v39.68c-.2 0-.32.02-.43 0-3.45-.87-6.95-1.45-10.49-1.76-5.38-.48-10.56.22-15.53 2.4-2.6 1.14-5.06 2.52-7.32 4.2z" fill="#015f94" /><path d="m98.37 45.28c-2.44-1.67-4.94-2.98-7.57-4.04-4.33-1.75-8.81-2.39-13.43-1.84-3.11.37-6.19.92-9.37 1.41v-.63c0-12.5 0-24.99-.02-37.49 0-.73.27-.92.89-1.08 3.32-.83 6.67-1.35 10.09-1.56 5.18-.31 10.02.95 14.62 3.25 1.51.76 2.94 1.66 4.38 2.55.23.14.43.53.43.8.02 12.69.02 25.38.02 38.07 0 .14-.02.28-.04.56z" fill="#fff" /><path d="m131.01 41.22c-10.58-3.35-20.46-2.2-29.68 4.29-.02-.4-.04-.63-.04-.85 0-12.57 0-25.13-.01-37.7 0-.49.14-.79.57-1.05 4.31-2.74 8.9-4.76 13.98-5.51 2.84-.42 5.71-.28 8.54.17 2.23.35 4.44.85 6.66 1.29v39.38z" fill="#fff" /><path d="m100.12 49.9c2.27-1.68 4.73-3.06 7.32-4.2 4.97-2.17 10.14-2.88 15.53-2.4 3.55.32 7.04.89 10.49 1.76.11.03.23 0 .43 0v-39.67c1.03.14 1.97.27 2.94.41v42.68c-1.62-.34-3.19-.7-4.77-.99-4.8-.89-9.63-1.47-14.51-1.05-6.41.56-12.1 2.99-17.09 7.07-.09.08-.19.15-.31.26-.62-.48-1.23-.99-1.87-1.45-6.07-4.32-12.8-6.31-20.26-5.97-4.87.22-9.66.95-14.42 1.99-.16.04-.33.08-.5.11-.07.01-.14 0-.22-.01v-42.82c.75-.12 1.46-.22 2.27-.35v39.87c1.45-.29 2.79-.57 4.14-.83 4.6-.87 9.25-1.4 13.93-1.05 5.21.39 9.95 2.27 14.38 4.98.84.52 1.65 1.09 2.51 1.65z" fill="#c9e7ef" /><path d="m118.27 9.2c-.6-.25-1.23-.28-1.86-.18-5.31.85-9.62 3.46-13.01 7.58-.9 1.09-1.62 2.34-2.39 3.48-.04-.13-.07-.37-.17-.58-.16-.34-.06-.59.12-.88.45-.75-.12-.79-.54-.12-.18-.07-.32-.16-.46-.16s-.28.08-.44.12c-.27-.5-.86-.56-.48.27.05.12.11.28.08.39-.12.39-.29.77-.44 1.18-.34-.75-.64-1.49-1.01-2.19-2.57-4.8-6.43-8.12-11.54-10-.9-.33-1.81-.64-2.8-.64-1.08 0-2.03.67-2.28 1.7-.11.45-.13.95-.07 1.41.36 2.87.74 5.75 1.16 8.61.14.96.38 1.91.66 2.83.25.8.87 1.29 1.71 1.45.32.06.64.12 1.01.18-.89.93-1.19 2.04-1.14 3.24.1 2.2.77 4.22 1.98 6.06.98 1.5 2.17 2.81 3.76 3.68 1.71.94 3.25.76 4.69-.55.44-.4.86-.84 1.19-1.32.89-1.32 1.74-2.67 2.6-4.01.07-.1.14-.2.24-.35.05 1.04.1 2 .47 2.92.43-.93.6-1.92.73-3 .1.19.17.3.23.41.51 1.01.98 2.04 1.52 3.03.46.84.93 1.69 1.52 2.45.87 1.12 2.05 1.68 3.5 1.56.97-.08 1.85-.44 2.64-.99 2.83-1.98 4.6-4.67 5.27-8.05.27-1.35.13-2.69-.74-3.85 0-.01 0-.04 0-.07.03 0 .07-.01.1-.01 1.75 0 2.59-.59 3.01-2.28.87-3.48 1.71-6.96 2.53-10.45.32-1.34-.22-2.43-1.35-2.89z" fill="#015f94" /></svg>
              </div>
              <ViewSwitcher
                currentSelection={switcherSelectionForPath()}
                showAdmin={isUserSignedIn}
              />
              <div className={clsx(
                'flex-grow text-right text-ellipsis overflow-hidden',
                'hidden xs:block',
              )}>
                {/* {renderLink(siteDomainOrTitle, PATH_ROOT)} */}
              </div>
            </div>]
            : []}
        />
      }
    />
  );
};
